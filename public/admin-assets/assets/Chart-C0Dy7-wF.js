const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Aoewh6E7.js","assets/index-Cks8rTuj.js","assets/index-Ctvnti3N.css","assets/index-C9DuXPTk.js","assets/index-DVK099C8.js","assets/bmap-aUnw2Cn1.js","assets/echarts-wordcloud-B8i84dIX.js"])))=>i.map(i=>d[i]);
import{s as __extends,bf as debounce,E as __awaiter,G as __generator,V as isApiOutdated,v as isPureVariable,w as resolveVariableAndFilter,K as filter,a3 as createObject,y as __assign,az as pick,o as __vitePreload,aI as __read,ck as dataMapping,aK as isAlive,b2 as buildStyle,f as React__default,ag as cx,ad as setThemeClassName,ds as themedLazyComponent,ae as CustomStyle,T as ScopedContext,z as __decorate,D as Renderer,d5 as ServiceStore,Q as __metadata,dt as findObjectsWithKey,bz as __values,aq as str2function,c5 as resizeSensor,du as loadScript,di as normalizeApiResponseData,b6 as isString,X as isEffectiveApi}from"./index-Cks8rTuj.js";var DEFAULT_EVENT_PARAMS=["componentType","seriesType","seriesIndex","seriesName","name","dataIndex","data","dataType","value","color"],EVAL_CACHE={};function recoverFunctionType(config){["interval","formatter","color","min","max","labelFormatter","valueFormatter","pageFormatter","optionToContent","contentToOption","animationDelay","animationDurationUpdate","animationDelayUpdate","animationDuration","position","sort","renderItem"].forEach(function(key){var e_1,_a,objects=findObjectsWithKey(config,key);try{for(var objects_1=__values(objects),objects_1_1=objects_1.next();!objects_1_1.done;objects_1_1=objects_1.next()){var object=objects_1_1.value,code=object[key];if(typeof code=="string"&&code.trim().startsWith("function"))try{code in EVAL_CACHE||(EVAL_CACHE[code]=eval("("+code+")")),object[key]=EVAL_CACHE[code]}catch(m){console.warn(code,m)}}}catch(m){e_1={error:m}}finally{try{objects_1_1&&!objects_1_1.done&&(_a=objects_1.return)&&_a.call(objects_1)}finally{if(e_1)throw e_1.error}}})}var Chart=function(m){__extends(o,m);function o(t){var e=m.call(this,t)||this;return e.refFn=e.refFn.bind(e),e.reload=e.reload.bind(e),e.reloadEcharts=debounce(e.reloadEcharts.bind(e),300),e.handleClick=e.handleClick.bind(e),e.dispatchEvent=e.dispatchEvent.bind(e),e.loadChartMapData=e.loadChartMapData.bind(e),e.mounted=!0,t.config&&e.renderChart(t.config),e}return o.prototype.componentDidMount=function(){return __awaiter(this,void 0,void 0,function(){var t,e,a,r,n,i,s,d;return __generator(this,function(l){switch(l.label){case 0:return t=this.props,e=t.api,a=t.data,r=t.initFetch,n=t.source,i=t.dispatchEvent,[4,i("init",a,this)];case 1:return s=l.sent(),s!=null&&s.prevented?[2]:(n&&isPureVariable(n)?(d=resolveVariableAndFilter(n,a,"| raw"),d&&this.renderChart(d)):e&&r!==!1&&this.reload(),[2])}})})},o.prototype.componentDidUpdate=function(t){var e=this,a=this.props;if(isApiOutdated(t.api,a.api,t.data,a.data))this.reload();else if(a.source&&isPureVariable(a.source)){var r=t.source?resolveVariableAndFilter(t.source,t.data,"| raw"):null,n=resolveVariableAndFilter(a.source,a.data,"| raw");r!==n&&this.renderChart(n||{})}else if(a.config!==t.config)this.renderChart(a.config||{});else if(a.config&&a.trackExpression&&filter(a.trackExpression,a.data)!==filter(t.trackExpression,t.data))this.renderChart(a.config||{});else if(isApiOutdated(t.mapURL,a.mapURL,t.data,a.data)){var i=a.source,s=a.data,d=a.api,l=a.config;this.loadChartMapData(function(){if(i&&isPureVariable(i)){var _=resolveVariableAndFilter(i,s,"| raw");_&&e.renderChart(_)}else d?e.reload():l&&e.renderChart(l||{})})}},o.prototype.componentWillUnmount=function(){this.mounted=!1,this.reloadEcharts.cancel(),clearTimeout(this.timer)},o.prototype.loadChartMapData=function(t){return __awaiter(this,void 0,void 0,function(){var e,a,r,n,i,s,d;return __generator(this,function(l){switch(l.label){case 0:return e=this.props,a=e.env,r=e.data,n=this.props,i=n.mapName,s=n.mapURL,s&&i&&window.echarts?(isPureVariable(i)&&(i=resolveVariableAndFilter(i,r)),[4,a.fetcher(s,r)]):[3,2];case 1:d=l.sent(),d.ok||console.warn("fetch map geo error "+s),window.echarts.registerMap(i,d.data),l.label=2;case 2:return t&&t(),[2]}})})},o.prototype.handleClick=function(t){return __awaiter(this,void 0,void 0,function(){var e,a,r,n,i,s;return __generator(this,function(d){switch(d.label){case 0:return e=this.props,a=e.onAction,r=e.clickAction,n=e.data,i=e.dispatchEvent,[4,i(t.event,createObject(n,__assign({},pick(t,DEFAULT_EVENT_PARAMS))))];case 1:return s=d.sent(),s!=null&&s.prevented?[2]:(r&&a&&a(null,r,createObject(n,t)),[2])}})})},o.prototype.dispatchEvent=function(t){var e=this.props,a=e.data,r=e.dispatchEvent;r(t.event||t.type,createObject(a,__assign({},pick(t,t.type==="legendselectchanged"?["name","selected"]:DEFAULT_EVENT_PARAMS))))},o.prototype.refFn=function(t){var e=this,a=this.props.chartRef,r=this.props,n=r.chartTheme,i=r.onChartWillMount,s=r.onChartUnMount,d=r.env,l=r.loadBaiduMap;r.data;var _=this.props,b=_.mapURL,C=_.mapName,c=this.props.onChartMount||this.onChartMount;t?Promise.all([__vitePreload(()=>import("./index-DVK099C8.js").then(h=>h.i),[]),__vitePreload(()=>import("./index-Aoewh6E7.js").then(h=>h.i),__vite__mapDeps([0,1,2])),__vitePreload(()=>import("./index-C9DuXPTk.js"),__vite__mapDeps([3,4])),__vitePreload(()=>import("./bmap-aUnw2Cn1.js"),__vite__mapDeps([5,4])),__vitePreload(()=>import("./echarts-wordcloud-B8i84dIX.js").then(h=>h.e),__vite__mapDeps([6,1,2]))]).then(function(h){var v=__read(h,2),f=v[0],u=v[1];return __awaiter(e,void 0,void 0,function(){var g,w=this;return __generator(this,function(p){switch(p.label){case 0:return window.echarts=f,window.ecStat=(u==null?void 0:u.default)||u,b&&C?[4,this.loadChartMapData()]:[3,2];case 1:p.sent(),p.label=2;case 2:return l?[4,loadScript("//api.map.baidu.com/api?v=3.0&ak=".concat(this.props.ak,"&callback={{callback}}"))]:[3,4];case 3:p.sent(),p.label=4;case 4:return g="default",n&&(f.registerTheme("custom",n),g="custom"),i?[4,i(f)]:[3,6];case 5:p.sent(),p.label=6;case 6:return u.transform&&(f.registerTransform(u.transform.regression),f.registerTransform(u.transform.histogram),f.registerTransform(u.transform.clustering)),d.loadChartExtends?[4,d.loadChartExtends()]:[3,8];case 7:p.sent(),p.label=8;case 8:return this.echarts=f.init(t,g),typeof c=="string"&&(c=str2function(c,"chart","echarts")),c==null||c(this.echarts,f),this.echarts.on("click",this.handleClick),this.echarts.on("mouseover",this.dispatchEvent),this.echarts.on("legendselectchanged",this.dispatchEvent),this.unSensor=resizeSensor(t,function(){var y,A=t.offsetWidth,E=t.offsetHeight;(y=w.echarts)===null||y===void 0||y.resize({width:A,height:E})}),a&&a(this.echarts),this.renderChart(),[2]}})})}):(a&&a(null),this.unSensor&&this.unSensor(),this.echarts&&(s==null||s(this.echarts,window.echarts),this.echarts.dispose(),delete this.echarts)),this.ref=t},o.prototype.doAction=function(t,e,a){var r,n;return(n=(r=this.echarts)===null||r===void 0?void 0:r.dispatchAction)===null||n===void 0?void 0:n.call(r,__assign({type:t.actionType},e))},o.prototype.reload=function(t,e,a,r,n){var i,s,d,l,_,b;return __awaiter(this,void 0,void 0,function(){var C,c,h,v,f,u,g,w,p,y,A=this;return __generator(this,function(E){switch(E.label){case 0:if(C=this.props,c=C.api,h=C.env,v=C.store,f=C.translate,e)return[2,this.receive(e,void 0,n)];if(!h||!h.fetcher||!isEffectiveApi(c,v.data))return[2];clearTimeout(this.timer),this.reloadCancel&&(this.reloadCancel(),delete this.reloadCancel,(i=this.echarts)===null||i===void 0||i.hideLoading()),(s=this.echarts)===null||s===void 0||s.showLoading(),v.markFetching(!0),E.label=1;case 1:return E.trys.push([1,3,,4]),[4,h.fetcher(c,v.data,{cancelExecutor:function(T){return A.reloadCancel=T}})];case 2:return u=E.sent(),isAlive(v)&&v.markFetching(!1),u.ok?(delete this.reloadCancel,g=normalizeApiResponseData(u.data),!g.series&&this.props.config?(w=createObject(this.props.data,g),this.renderChart(this.props.config,w)):this.renderChart(u.data||{}),(_=this.echarts)===null||_===void 0||_.hideLoading(),p=this.props.interval,p&&isString(p)&&(p=Number.parseInt(p)),p&&this.mounted&&(this.timer=setTimeout(this.reload,Math.max(p,1e3))),[2,v.data]):(!(c!=null&&c.silent)&&h.notify("error",(l=(d=c==null?void 0:c.messages)===null||d===void 0?void 0:d.failed)!==null&&l!==void 0?l:u.msg||f("fetchFailed"),u.msgTimeout!==void 0?{closeButton:!0,timeout:u.msgTimeout}:void 0),[2]);case 3:return y=E.sent(),h.isCancel(y)?[2]:(isAlive(v)&&v.markFetching(!1),!(c!=null&&c.silent)&&h.notify("error",y),(b=this.echarts)===null||b===void 0||b.hideLoading(),[3,4]);case 4:return[2]}})})},o.prototype.receive=function(t,e,a){var r=this.props.store;r.updateData(t,void 0,a),this.reload()},o.prototype.renderChart=function(t,e){var a,r;if(t&&(this.pending=t),e&&(this.pendingCtx=e),!!this.echarts){var n=this.props.store,i=this.props.onDataFilter,s=this.props.dataFilter;!i&&typeof s=="string"&&(i=new Function("config","echarts","data",s)),t=t||this.pending,e=e||this.pendingCtx||this.props.data,typeof t=="string"&&(t=new Function("return "+t)());try{i&&(t=i(t,window.echarts,e)||t)}catch(d){console.warn(d)}if(t)try{this.props.disableDataMapping||(t=dataMapping(t,e,function(d,l){return typeof l=="function"||typeof l=="string"&&l.startsWith("function")})),recoverFunctionType(t),isAlive(n)&&n.loading?(a=this.echarts)===null||a===void 0||a.showLoading():(r=this.echarts)===null||r===void 0||r.hideLoading(),this.reloadEcharts(t)}catch(d){console.warn(d)}}},o.prototype.reloadEcharts=function(t){var e;(e=this.echarts)===null||e===void 0||e.setOption(t,this.props.replaceChartOption)},o.prototype.render=function(){var t=this,e=this.props,a=e.className,r=e.width,n=e.height,i=e.classPrefix,s=e.unMountOnHidden,d=e.data,l=e.id,_=e.wrapperCustomStyle,b=e.env,C=e.themeCss;e.baseControlClassName;var c=this.props.style||{};c.width=c.width||r||"100%",c.height=c.height||n||"300px";var h=buildStyle(c,d);return React__default.createElement("div",{className:cx("".concat(i,"Chart"),a,setThemeClassName(__assign(__assign({},this.props),{name:"baseControlClassName",id:l,themeCss:C})),setThemeClassName(__assign(__assign({},this.props),{name:"wrapperCustomStyle",id:l,themeCss:_}))),style:h},React__default.createElement(themedLazyComponent,{unMountOnHidden:s,placeholder:"...",component:function(){return React__default.createElement("div",{className:"".concat(i,"Chart-content"),ref:t.refFn})}}),React__default.createElement(CustomStyle,__assign({},this.props,{config:{wrapperCustomStyle:_,id:l,themeCss:C,classNames:[{key:"baseControlClassName"}]},env:b})))},o.defaultProps={replaceChartOption:!1,unMountOnHidden:!1},o.propsList=[],o}(React__default.Component),ChartRenderer=function(m){__extends(o,m);function o(t,e){var a=m.call(this,t)||this,r=e;return r.registerComponent(a),a}return o.prototype.componentWillUnmount=function(){m.prototype.componentWillUnmount.call(this);var t=this.context;t.unRegisterComponent(this)},o.prototype.setData=function(t,e){var a=this.props.store;a.updateData(t,void 0,e),this.renderChart(this.props.config,a.data)},o.prototype.getData=function(){var t=this.props.store;return t.data},o.contextType=ScopedContext,o=__decorate([Renderer({type:"chart",storeType:ServiceStore.name}),__metadata("design:paramtypes",[Object,Object])],o),o}(Chart);export{Chart,ChartRenderer};
